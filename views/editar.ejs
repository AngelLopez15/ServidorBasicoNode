<%- include('templates/cabecera', {tituloWeb:'Editar Mascota'}); %>
  
  <div class="container">
    <h1>Editar Datos de Mascota</h1>

    <% if (error) { %>
      <p>
        <%= mensaje %> 
      </p>
      <a href="/mascotas" class="btn btn-dark btn-block">Volver a mascotas</a>
    <% } %>

    <table class="table">
      <thead class="thead-dark">
        <tr>
          <th scope="col">#</th>
          <th scope="col">Nombre</th>
          <th scope="col">Descripción</th>
          <th scope="col">Acción</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th scope="row"><%= mascota.id %></th>
          <td><%= mascota.nombre %></td>
          <td><%= mascota.descripcion %></td>
          <td>
            <!-- Con la propiedad data-set podemos pasar el id -->
            <button
              class="btn btn-danger btn-sm"
              id="btnEliminar"
              data-id="<%= mascota.id %>"
            >
              Eliminar
            </button>
          </td>
        </tr>    
      </tbody>
    </table>

  </div>
  
<%- include('templates/footer'); %>

<!-- Agregando el evento Js dentro de esta vista como se hace en vue -->

<script>

  const btnEliminar = document.querySelector('#btnEliminar');
  
  btnEliminar.addEventListener('click', async()=>{
    console.log('click')
    // obteniendo el id que esta en data set y guardandolo en el id
    const id = btnEliminar.dataset.id
    
    console.log(id)

    try {
      // Debemos especificarle el verbo que debe hacer si no por default hara un get
      const data = await fetch(`/mascotas/${id}`, {method:'delete'})
      
      console.log(data)

      // obteniendo la respuesta
      const res = await data.json()

      if (res.estado) {
        // si el estado es true osea que el resgistro se elimino. Entonces redirigimos
        // al usuaria al la vista mascotas
        window.location.href = '/mascotas'
      }else{
        console.log(error)
      }

    } catch (error) {
      
    }
  });

</script>